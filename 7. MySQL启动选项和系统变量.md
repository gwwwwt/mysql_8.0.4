# MySQL启动选项和系统变量



## 1. 启动选项和配置文件



### 1.1 在命令行上使用选项

> **服务器禁止客户端的TCP/IP网络连接选项: **
>
> ```shell
> mysqld --skip-networking
> ```



> **在命令行中`指定启动选项时需要在选项名前加上'--'前缀`。另外，如果选项名是由多个单词构成的，`它们之间可以由短划线'-'连接，也可以使用下划线'_'连接`，即 skip-networking 启动选项和 skip_networking 表示的含义相同**



> **启动服务器程序的命令行后边指定启动选项的能用格式是: **
>
> ```shell
> # 注: 选项名、=、选项值之间不可以有空白字符
> --启动选项1[=值1] --启动选项2[=值2] ... --启动选项n[=值n]
> ```



> **选项的长形式和短形式**
>
> | 长形式     | 短形式 | 含义     |
> | ---------- | ------ | -------- |
> | --host     | -h     | 主机名   |
> | --user     | -u     | 用户名   |
> | --password | -p     | 密码     |
> | --port     | -P     | 端口     |
> | --version  | -V     | 版本信息 |
>
> > **在短形式选项时，选项名和选项值之间可以没有间隙，也可以用空白字符隔开（但不能用'='），如: **
> >
> > ```shell
> > mysqld -P3307
> > 
> > # 和上面的命令意义相同
> > mysqld -P 3307
> > ```



### 1.2 配置文件中使用选项

#### 1.2.1 配置文件的路径

> **MySQL启动时会在多个路径下寻找配置文件，这些路径有的是固定的，有的可以在命令行中指定。**

> **Windows操作系统中的路径: **
>
> | 路径                            | 备注                         |
> | ------------------------------- | ---------------------------- |
> | %WINDIR%\my.ini,%WINDIR%\my.cnf |                              |
> | C:\my.ini, C:\my.cnf            |                              |
> | BASEDIR\my.ini, BASEDIR\my.cnf  |                              |
> | defaults-extra-file             | 命令行指定的额外配置文件路径 |
> | %APPDATA%\MySQL\.mylogin.cnf    | 登录路径选项（仅限客户端）   |

> **类UNIX操作系统中的路径: **
>
> | 路径                | 备注                                   |
> | ------------------- | -------------------------------------- |
> | /etc/my.cnf         |                                        |
> | /etc/mysql/my.cnf   |                                        |
> | SYSCONFDIR/my.cnf   |                                        |
> | $MYSQL_HOME/my.cnf  | 特定于服务器的选项（仅限服务器）       |
> | defaults-extra-file | 命令行指定的额外配置文件路径           |
> | ～/.my.cnf          | 特定于用户的选项                       |
> | ～/.mylogin.cnf     | 特定于用户的登录路径选项（仅限客户端） |



#### 1.2.2 配置文件的内容

> **与命令行中指定启动选项不同的是，`配置文件中的启动选项被划分为若干个组，每个组有一个组铝，用中括号[]括起来`**
>
> ```properties
> [server]
> option1 #选项不需要选项值
> option2 = value2 #选项需要选项值
> (具体的启动选项...)
> 
> [mysqld]
> (具体的启动选项...)
> 
> [mysqld_safe]
> (具体的启动选项...)
> 
> [client]
> (具体的启动选项...)
> 
> [mysql]
> (具体的启动选项...)
> 
> [mysqladmin]
> (具体的启动选项...)
> ```
>
> > **注：**
> >
> > + **1. 配置文件中指定的启动选项只能使用长形式的选项**
> > + **2. 配置文件中指定的启动选项不允许加'--'前缀**
> > + **3. 每行只能指定一个选项**
> > + **4. 等号'=' 周围可以有空白字符**
> > + **5. 可以用'#'来添加注释**



> **`在配置文件中，不同的选项组是给不两只的程序使用的。如果选项组名称与程序名称相同，则组中的选项将专门应用于该程序`。如 [mysqld] 和 [mysql] 组分别应用于mysqld程序和mysql程序。**
>
> **有2个选项组比较特别: **
>
> + **[server]组下面的启动选项将作用于所有的服务器程序**
> + **[client]组下面的启动选项将作用于所有的客户端程序**
>
> > **此外，mysqld_safe 和mysql_server 这两个程序在启动时都会读取[mysqld]选项组中的内容。**

**程序的对应类别和能读取的组: **

| 程序名       | 类别       | 能读取的组                          |
| ------------ | ---------- | ----------------------------------- |
| mysqld       | 启动服务器 | [mysqld]、[server]                  |
| mysqld_safe  | 启动服务器 | [mysqld]、[server]、[mysqld_safe]   |
| mysql_server | 启动服务器 | [mysqld]、[server]、[mysqld.server] |
| mysql        | 启动客户端 | [mysql]、[client]                   |
| mysqladmin   | 启动客户端 | [mysqladmin]、[client]              |
| mysqldump    | 启动客户端 | [mysqldump]、[client]               |

> **例如:  在MacOS系统 /etc/mysql/my.cnf 配置文件中添加一些内容如下: **
>
> ```properties
> [server]
> skip-networking
> default-storage-engine=MyISAM		
> ```
>
> **然后直接用mysqld启动服务器: **
>
> ```shell
> mysqld
> ```
>
> > **此时/etc/mysql/my.cnf 中添加的配置是生效的**
> >
> > **但是如果将添加的配置归到[client]组时，这些配置是不会生效的**



#### 1.2.3 特定MySQL版本的专用选项组

> **```可以在选项组名称后加上特定的MySQL版本号，如[mysqld-5.7]选项组名，它的含义和[mysqld]一样，但是只有版本号为5.7的mysqld程序才能使用这个选项组中的选项.```**



#### 1.2.4 配置文件的优先级

> **MySQL程序使用1.2.1节表中的顺序依次读取各个配置文件，如果没有对应文件，则忽略。**
>
> **`如果在多个配置文件中设置了相同的选项，则以最后一个配置文件中的为准`**



#### 1.2.5 同一个配置文件中多个组的优先级

> **如下所示，在一个配置文件的多个组中同时出现了相同的启动选项: **
>
> ```properties
> [server]
> default-storage-engine=InnoDB
> 
> [mysqld]
> default-storage-engine=MyISAM
> ```
>
> **那么，将以最后一个出现的组中的启动选项为准**



#### 1.2.6 defaults-file的应用

> **如果不想让MySQL到默认的路径下搜索配置文件，可以在命令行中指定 `defauls-file` 选项，如下: **
>
> ```shell
> mysqld --defaults-file=/tmp/myconfig.txt
> ```
>
> **这样，程序启动时只会在/tmp/myconfig.txt文件中读取配置信息**



## 2. 系统变量



### 2.1 查看系统变量

> ```sql
> SHOW VARIABLES [LIKE 匹配模式]
> ```



### 2.2 设置系统变量

> + **1. 通过启动选项设置，如命令行参数或配置文件**
> + **2. 服务器运行过程中设置**



### 2.3 服务器运行过程中设置系统变量

#### 2.3.1 设置不同作用范围的系统变量

> **MySQL设计了2种系统变量的作用范围: **
>
> + **GLOBAL（全局范围）: 影响服务器的整体操作**
> + **SESSION（会话范围）: 影响某个客户端连接的操作**

> **服务器在启动时，会将每个全局变量初始化为其默认值（可以通过命令行或配置文件中指定的选项来更改这些默认值）。服务器还为每个连接的客户端维护一组会话变量，客户端的会话变量在连接时使用相应全局变量的当前值进行初始化。**

> **设置系统变量的sql:**
>
> ```sql
> SET [GLOBAL|SESSION] 系统变量名 = 值; 
> #或
> SET [@@(GLOBAL|SESSION).]系统变量名 = 值;
> ```
>
> > **如果在设置系统变量的语句中省略了作用范围，默认的作用范围就是SESSION**



#### 2.3.2 查看不同作用范围的系统变量

> ```sql
> SHOW [GLOBAL|SESSION] VARIABLES [LIKE 匹配模式];
> ```



#### 2.3.3 注意事项

> + **并不是所有的系统变量都具有GLOBAL和SESSION的作用范围**
>   + **有一些系统变量只具有GLOBAL作用范围，如max_connections，表示服务器支持同时最多有多少客户端连接**
>   + **有一些系统变量只有SESSION作用范围，如insert_id**
>   + **有一些系统变量的值既具有GLOBAL作用范围，也具有SESSION作用范围，如default_storage_engine**
> + **有些系统变量是只读的，并不能设置值。比如version，表示当前是MySQL版本。客户端不能设置它的值**



## 3. 状态变量

> **MySQL设计了状态变量来显示服务器程序运行情况，类似系统变量，但不能人为设置。**
>
> ```mysql
> SHOW [GLOBAL|SESSION] STATUS [LIKE 匹配模式];
> ```